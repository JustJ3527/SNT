<!DOCTYPE html>
<html lang="fr">
  <head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">

      <!--install ScrollTrigger-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/ScrollTrigger.min.js"></script>

      <!--install AwesomeFont-->
      <script src="https://kit.fontawesome.com/2dd49550a9.js" crossorigin="anonymous"></script>
      
      <!--link CSS-->
      <link href="CSS/reset.css" rel="stylesheet" type="text/css">
      <link href="CSS/style.css" rel="stylesheet" type="text/css">
      
      <title>INDEX</title>
  </head>  
  <body>
    <header>
      <nav>
        <div class="nav-container">
          <ul>
            <li><h3>Logo</h3></li>
            <div style="display: flex;">
              <li><a href="#">Nos voitures</a></li>
              <li><a href="#">Actualit√©s</a></li>
              <li><a href="#">Qui sommes-nous ?</a></li>
            </div>
            <li class="bg"><a href="#"><i class="fa-solid fa-circle-user"></i></a></li>
          </ul>
        </div>
      </nav>
    </header>
    <div class="main-page">
      <img src="https://www.renaultgroup.com/wp-content/uploads/2022/10/r-dam_1441432.jpg" class="background main fs" alt="Alpine">
    </div>
    <div class="nd-container">
      <section class="comparisonSection">
        <div class="comparisonImage beforeImage">
          <img src="https://cdn.group.renault.com/alp/master/alpine-new-cars/editorial/concept-cars/dream-racer/editorial/alpine-alpenglow-003.jpg.ximg.large.webp/866cbb9210.webp" alt="before" style="object-fit: cover;">
          <h1 style="color: red; z-index: 4000;">Image 1</h1>
        </div>
        <div class="comparisonImage afterImage">
          <img src="https://cdn.group.renault.com/alp/master/alpine-new-cars/editorial/concept-cars/dream-racer/editorial/alpine-alpenglow-002.jpg.ximg.large.webp/5244a33cc7.webp" alt="after" style="object-fit: cover;">
        </div>
      </section>
      <div class="nd-container">
        <div class="video-container">
          <video id="video2" class="video-scrub" src="studio-light-turntable.mp4" playsinline="true"  webkit-playsinline="true" preload="metadata" muted="muted">
          </video>
        </div>
      </div>
    </div>
  </body>  

  <script type="text/javascript">
    gsap.utils.toArray(".comparisonSection").forEach(section => {
	    let tl = gsap.timeline({
        scrollTrigger: {
          trigger: section,
          start: "center center",
          // makes the height of the scrolling (while pinning) match the width, thus the speed remains constant (vertical/horizontal)
          end: () => "+=" + section.offsetWidth, 
          scrub: true,
          pin: true,
          anticipatePin: 1
        },
			  defaults: {ease: "none"}
		  });
    // animate the container one way...
    tl.fromTo(section.querySelector(".afterImage"), { xPercent: 100, x: 0}, {xPercent: 0})
      // ...and the image the opposite way (at the same time)
      .fromTo(section.querySelector(".afterImage img"), {xPercent: -100, x: 0}, {xPercent: 0}, 0);
  });

  gsap.registerPlugin(ScrollTrigger);
/* The encoding is super important here to enable frame-by-frame scrubbing. */
// ffmpeg -i ~/Downloads/Toshiba\ video/original.mov -movflags faststart -vcodec libx264 -crf 23 -g 1 -pix_fmt yuv420p output.mp4
// ffmpeg -i ~/Downloads/Toshiba\ video/original.mov -vf scale=960:-1 -movflags faststart -vcodec libx264 -crf 20 -g 1 -pix_fmt yuv420p output_960.mp4

gsap.utils.toArray(".video-scrub").forEach(video => videoScrub(video, {
  scrollTrigger: {
    trigger: video,
    start: "center center",
    end: "+=600",
    markers: true,
    scrub: true,
    pin: true
  }
}));

function videoScrub(video, vars) {
  video = gsap.utils.toArray(video)[0]; // in case selector text is fed in.
  let once = (el, event, fn) => {
        let onceFn = function () {
          el.removeEventListener(event, onceFn);
          fn.apply(this, arguments);
        };
        el.addEventListener(event, onceFn);
        return onceFn;
      },
      prepFunc = () => { video.play(); video.pause(); },
      prep = () => once(document.documentElement, "touchstart", prepFunc),
      src = video.currentSrc || video.src,
      tween = gsap.fromTo(video, {currentTime: 0}, {paused: true, immediateRender: false, currentTime: video.duration || 1, ease: "none", ...vars}),
      resetTime = () => (tween.vars.currentTime = video.duration || 1) && tween.invalidate();
  prep();
  video.readyState ? resetTime() : once(video, "loadedmetadata", resetTime);
  return tween;
}
  </script>
</html>
